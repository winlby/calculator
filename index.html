<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Калькулятор вывода криптовалют</title>


<style>
body{font-family:'Segoe UI',Tahoma,sans-serif;display:flex;justify-content:center;align-items:flex-start;padding:30px 0;margin:0;background:linear-gradient(135deg,#37aee2,#1c9ceb);} 
.page-container{display:flex;flex-direction:column;align-items:center;width:100%;max-width:400px;margin:0 auto;text-align:center;} 
.tabs{display:flex;justify-content:center;align-items:center;gap:5px;width:100%;margin-bottom:15px;} 
.tab-btn{flex:none;background:#ffffffaa;border:none;padding:10px 15px;border-radius:10px 10px 0 0;cursor:pointer;font-size:1em;font-weight:600;transition:all .3s;} 
.tab-btn.active{background:#fff;color:#1c9ceb;} 
.tab-content{display:none;width:100%;} 
.tab-content.active{display:block;} 
.calculator,.converter,.simple-calc{background:#fff;padding:30px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.1);text-align:center; width: auto; max-width: 380px;margin: 0 auto 20px;box-sizing: border-box; } 
h1{font-size:1.5em;margin-bottom:20px;color:#222;} 
select,input{width:100%;padding:10px;margin:10px 0;border-radius:10px;border:1px solid #ddd;font-size:1em;transition:all .3s;} 
input:disabled,select:disabled{background:#f0f0f0;color:#999;cursor:not-allowed;} 
button{padding:4px 10px;border-radius:6px;border:none;background:#1c9ceb;color:#fff;font-size:.8em;cursor:pointer;margin-left:10px;transition:background .3s;vertical-align:middle;} 
button:hover{background:#0d7ecf;} 
button:disabled{background:#aaa;cursor:not-allowed;} 
.result{margin-top:20px;font-size:1.1em;padding:10px;border-radius:10px;transition:all .3s;} 
.note{margin-top:10px;font-size:.9em;color:#444;background:#f5f5f5;padding:8px;border-radius:8px;text-align:left;} 
.note-small{margin-top:10px;font-size:.8em;color:#666;text-align:left;display:flex;align-items:center;} 
.warning{background:#ffe0e0;color:#c00;} 
.success{background:#e0ffe0;color:#080;} 
.loading{background:#fff3cd;color:#a67c00;} 
.callout-yellow{background-color:#fff3cd;color:#856404;padding:10px;border-radius:10px;margin-top:10px;font-size:.95em;text-align:left;opacity:0;transform:translateY(10px);transition:opacity .8s ease,transform .8s ease;max-width:380px;width:100%;margin-left:auto;margin-right:auto;} 
.callout-yellow.visible{opacity:1;transform:translateY(0);} 
.calc-buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:5px;} 
.calc-buttons button{font-size:1.1em;padding:15px;} 
.calc-display-wrapper{position:relative;text-align:right;} 
.calc-display{width:100%;font-size:1.3em;padding:10px;margin-bottom:5px;text-align:right;} 
.calc-result-line{font-size:1.5em;text-align:right;color:#0d7ecf;font-weight:700;background:#e6f4ff;border-radius:10px;padding:5px 10px;margin-top:5px;box-shadow:inset 0 0 5px rgba(28,156,235,.2);user-select:text;transition:all .3s;} 
.converter select,.converter input{margin-bottom:15px;} 
#conv-result{background:#e6f4ff;border-radius:10px;font-weight:600;font-size:1.2em;padding:12px;color:#0d7ecf;transition:all .3s ease;box-shadow:inset 0 0 5px rgba(28,156,235,.15);}
</style>



</head>
<body>
<div class="page-container">
    <div class="tabs">
        <button class="tab-btn active" data-tab="withdraw">Вывод</button>
        <button class="tab-btn" data-tab="calc">Калькулятор</button>
        <button class="tab-btn" data-tab="convert">Конвертер</button>
    </div>

    <div class="tab-content active" id="withdraw">
        <div class="calculator">
            <h1>Калькулятор вывода</h1>
            <select id="crypto">
                <option value="USDT-TRC20">USDT (TRC-20)</option>
                <option value="USDT-TON">USDT (TON)</option>
                <option value="BTC">BTC</option>
                <option value="TON">TON</option>
                <option value="XAUT">XAUT</option>
                <option value="NOT">NOT</option>
                <option value="DOGS">DOGS</option>
                <option value="HMSTR">HMSTR</option>
                <option value="X">X</option>
                <option value="MAJOR">MAJOR</option>
                <option value="CATI">CATI</option>
                <option value="TAC">TAC</option>
                <option value="TRX">TRX</option>
                <option value="XLM">XLM</option>
                <option value="FLR">FLR</option>
                <option value="ETH">ETH</option>
                <option value="SOL">SOL</option>
            </select>
            <input type="number" id="amount" placeholder="Сумма" min="0" step="any">
            <div class="result" id="result"></div>
            <div class="note" id="note">
                Минимальный лимит обмена в долларах для всех пар, кроме пар с BTC — $1,3.<br>
                Минимальный лимит обмена в долларах для пар с BTC (в обе стороны) — $3.
            </div>
            <div class="note-small">
                * Курсы обновляются только по кнопке
                <button id="refreshBtn">Обновить</button>
            </div>
        </div>
        <div id="callouts"></div>
    </div>

    <div class="tab-content" id="calc">
      <div class="simple-calc">
        <h1>Калькулятор</h1>
        <div class="calc-display-wrapper">
          <input type="text" id="calc-display" class="calc-display" placeholder="Введите выражение">
          <div id="calc-result-line" class="calc-result-line">= 0</div>
        </div>
        <div class="calc-buttons">
          <button>7</button><button>8</button><button>9</button><button>/</button>
          <button>4</button><button>5</button><button>6</button><button>*</button>
          <button>1</button><button>2</button><button>3</button><button>-</button>
          <button>0</button><button>.</button><button>=</button><button>+</button>
          <button style="grid-column: span 4; background:#f55;">C</button>
        </div>
      </div>
    </div>

    <div class="tab-content" id="convert">
        <div class="converter">
            <h1>Конвертер в USDT</h1>
            <select id="conv-crypto">
                <option value="USDT-TRC20">USDT (TRC-20)</option>
                <option value="USDT-TON">USDT (TON)</option>
                <option value="BTC">BTC</option>
                <option value="TON">TON</option>
                <option value="XAUT">XAUT</option>
                <option value="NOT">NOT</option>
                <option value="DOGS">DOGS</option>
                <option value="HMSTR">HMSTR</option>
                <option value="X">X</option>
                <option value="MAJOR">MAJOR</option>
                <option value="CATI">CATI</option>
                <option value="TAC">TAC</option>
                <option value="TRX">TRX</option>
                <option value="XLM">XLM</option>
                <option value="FLR">FLR</option>
                <option value="ETH">ETH</option>
                <option value="SOL">SOL</option>
            </select>
            <input type="number" id="conv-amount" placeholder="Введите сумму" min="0" step="any">
            <div class="result" id="conv-result">Выберите валюту и введите сумму.</div>
            <div class="note-small">
                * Курсы обновляются только по кнопке
                <button id="refreshBtnConvert">Обновить</button>
            </div>
        </div>
    </div>
</div>

<script>
// ===== Данные комиссий и лимитов =====
const fees = {"USDT-TRC20":{fee:3.5,inUSD:false},"USDT-TON":{fee:1,inUSD:false},"BTC":{fee:0.0004,inUSD:false},"TON":{fee:0.05,inUSD:false},"XAUT":{fee:1,inUSD:true},"NOT":{fee:1,inUSD:true},"DOGS":{fee:1,inUSD:true},"HMSTR":{fee:1,inUSD:true},"X":{fee:1,inUSD:true},"MAJOR":{fee:1,inUSD:true},"CATI":{fee:1,inUSD:true},"TAC":{fee:1,inUSD:true},"TRX":{fee:0.3,inUSD:true},"XLM":{fee:0.4,inUSD:true},"FLR":{fee:0.3,inUSD:true},"ETH":{fee:3.79,inUSD:true},"SOL":{fee:0.006,inUSD:false}};
const minWithdraw={"USDT-TRC20":1,"USDT-TON":1,"BTC":0.0001,"TON":0.1,"XAUT":0.0002,"NOT":50,"DOGS":1000,"HMSTR":150,"X":6000,"MAJOR":1,"CATI":1,"TAC":0.1,"TRX":0,"XLM":0,"FLR":0,"ETH":0,"SOL":0};

// ===== CoinGecko IDs =====
const coinGeckoIds = {"USDT-TRC20":"tether","USDT-TON":"tether","BTC":"bitcoin","ETH":"ethereum","SOL":"solana","TON":"the-open-network","TRX":"tron","XLM":"stellar","NOT":"notcoin","DOGS":"dogs-2","HMSTR":"hamster-kombat","CATI":"catizen","XAUT":"tether-gold","X":"x-empire","FLR":"flare-networks","MAJOR":"major","TAC":"tac"};

let pricesCache={};
const cryptoSelect=document.getElementById("crypto");
const amountInput=document.getElementById("amount");
const resultDiv=document.getElementById("result");
const convSel=document.getElementById('conv-crypto');
const convAmount=document.getElementById('conv-amount');
const convResult=document.getElementById('conv-result');
const refreshBtn=document.getElementById("refreshBtn");
const refreshBtnConvert=document.getElementById("refreshBtnConvert");

// ====== Блокировка ввода ======
function lockInputs(lock){
    amountInput.disabled=lock; cryptoSelect.disabled=lock;
    convAmount.disabled=lock; convSel.disabled=lock;
    refreshBtn.disabled=lock; refreshBtnConvert.disabled=lock;
}

// ====== Получение курсов (только CoinGecko) ======


async function preloadPrices(){
    lockInputs(true);
    resultDiv.textContent="Загрузка курсов...";
    resultDiv.className="result loading";
    convResult.textContent="Загрузка курсов...";
    convResult.className="result loading";
    pricesCache={};

    const allSymbols = Object.keys(coinGeckoIds);

    try {
        const url = 'https://api.coingecko.com/api/v3/simple/price?ids=' +
                    allSymbols.map(s => coinGeckoIds[s]).join(',') +
                    '&vs_currencies=usd';
        console.log("Fetching:", url);
        const res = await fetch(url);
        const parsed = await res.json();
        console.log("CoinGecko response:", parsed);

        for(const s of allSymbols){
            if(parsed[coinGeckoIds[s]]?.usd !== undefined){
                pricesCache[s] = {price: parsed[coinGeckoIds[s]].usd};
            } else {
                console.warn(`Нет курса для ${s} (ID ${coinGeckoIds[s]})`);
            }
        }
    } catch(e) {
        console.error("Ошибка при получении курсов:", e);
    }

 // Задержка 3 секунды
    await new Promise(resolve => setTimeout(resolve, 3000));

    resultDiv.textContent="Курсы загружены.";
    resultDiv.className="result success";
    convResult.textContent="Курсы загружены.";
    convResult.className="result success";
    lockInputs(false);

    updateResult();
    updateConvert();
}







// ====== Вывод ======
function updateResult(){
    const c = cryptoSelect.value;
    const a = parseFloat(amountInput.value);
    const f = fees[c];
    const m = minWithdraw[c];
    const s = c.split('-')[0];

    resultDiv.className='result';
    if(isNaN(a)||a<=0){resultDiv.textContent="Введите корректную сумму.";resultDiv.classList.add("warning");return;}
    if(a < m){resultDiv.textContent=`Минимальная сумма вывода для ${s} — ${m} ${s}.`;resultDiv.classList.add("warning");return;}
    if(!pricesCache[c] || pricesCache[c].price === undefined){resultDiv.textContent=`⚠️ Курс для ${s} недоступен.`;resultDiv.classList.add("warning");return;}

    const p = pricesCache[c].price;
    const fee = f.inUSD ? f.fee / p : f.fee;
    const rem = a - fee;
    const feeTxt = f.inUSD ? `${f.fee} USD (~${fee.toFixed(6)} ${s})` : `${fee.toFixed(6)} ${s}`;
    if(rem < 0){resultDiv.textContent=`Сумма комиссии (${feeTxt}) превышает введённую сумму.`;resultDiv.classList.add("warning");return;}
    const remUSDT = rem * p;
    resultDiv.innerHTML=`После вычета комиссии (${feeTxt}) вы получите:<br><b>${rem.toFixed(6)} ${s}</b> ≈ <b>${remUSDT.toFixed(2)} USDT</b><br>`;
    resultDiv.classList.add("success");
}

// ====== Конвертер ======
function updateConvert(){
    const c = convSel.value;
    const a = parseFloat(convAmount.value);

    if(!pricesCache[c] || pricesCache[c].price === undefined){convResult.textContent='Курс недоступен'; return;}
    if(isNaN(a) || a <= 0){convResult.textContent='Введите сумму'; return;}

    const p = pricesCache[c].price;
    convResult.innerHTML=`${a} ${c} ≈ ${(a*p).toFixed(4)} USDT<br>`;
    convResult.style.background='#d6f2ff';
    setTimeout(()=>convResult.style.background='#e6f4ff',200);
}

cryptoSelect.addEventListener("change",updateResult);
amountInput.addEventListener("input",updateResult);
convSel.addEventListener('change',updateConvert);
convAmount.addEventListener('input',updateConvert);
refreshBtn.addEventListener("click",preloadPrices);
refreshBtnConvert.addEventListener("click",preloadPrices);

// ====== Вкладки ======
document.querySelectorAll('.tab-btn').forEach(b=>{
 b.addEventListener('click',()=>{
  document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  document.getElementById(b.dataset.tab).classList.add('active');
 });
});

// ====== Калькулятор ======
const display=document.getElementById('calc-display');
const resultLine=document.getElementById('calc-result-line');
let expression='';

function calculateAndShow(){ 
    if(expression.trim()===''){ 
        resultLine.textContent='= 0'; 
        return;
    } 
    try{
        // заменяем запятую на точку перед вычислением
        const expr = expression.replace(/,/g, '.');
        const res = eval(expr); 
        resultLine.textContent='= '+res;
    } catch {
        resultLine.textContent='= Ошибка';
    }
}

document.querySelectorAll('#calc .calc-buttons button').forEach(btn=>{
    btn.addEventListener('click',()=>{
        const val=btn.textContent;
        if(val==='C'){
            expression=''; display.value=''; resultLine.textContent='= 0';
        }
        else if(val==='='){
            try{
                const expr = expression.replace(/,/g, '.');
                const r = eval(expr);
                resultLine.textContent='= '+r; 
                expression = r.toString(); 
                display.value = expression;
            } catch {
                resultLine.textContent='= Ошибка';
            }
        }
        else{
            expression += val; 
            display.value = expression; 
            calculateAndShow();
        }
    });
});

display.addEventListener('input',()=>{
    expression = display.value; 
    calculateAndShow();
});

display.addEventListener('paste', e=>{
    e.preventDefault();
    const t = (e.clipboardData||window.clipboardData).getData('text');
    expression += t;
    display.value = expression;
    calculateAndShow();
});

display.addEventListener('copy', e=>{
    e.clipboardData.setData('text/plain', display.value); 
    e.preventDefault();
});

display.addEventListener('keydown', e=>{
    if(e.key==='Enter'){
        e.preventDefault(); 
        try{
            const expr = expression.replace(/,/g, '.');
            const r = eval(expr); 
            resultLine.textContent='= '+r; 
            expression = r.toString(); 
            display.value = expression;
        } catch {
            resultLine.textContent='= Ошибка';
        }
    }
});




// ====== Callouts ======
async function loadCallouts(){
 try{
   const r=await fetch('https://api.allorigins.win/get?url='+encodeURIComponent('https://help.ru.wallet.tg/article/73-komissii-limity-i-kursy'));
   const d=await r.json();
   const doc=new DOMParser().parseFromString(d.contents,'text/html');
   const c=doc.querySelectorAll('.callout-yellow');
   const cont=document.getElementById('callouts'); cont.innerHTML='';
   c.forEach((e,i)=>{ const div=document.createElement('div'); div.className='callout-yellow'; div.innerHTML=e.innerHTML; cont.appendChild(div); setTimeout(()=>div.classList.add('visible'),i*300); });
 }catch(e){console.log('Callouts не загрузились',e);}
}

// ====== Инициализация ======
(async()=>{await loadCallouts(); await preloadPrices();})();
</script>
</body>
</html>



